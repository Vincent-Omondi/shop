<% content_for :header do %>
  <section class="hero is-warning">
    <div class="hero-body">
      <div class="container">
        <h1 class="title">
          Browse new products
        </h1>
      </div>
    </div>
  </section>
<% end %>
  
<div class="product-index-grid pt4">
  <% @products.each do |product| %>
    <div class="product border-light">
      <div class="product-thumb">
        <% if product.image.present? %>
          <%= link_to image_tag(product.image_url(:thumb)), product %>
        <% else %>
          <%= link_to image_tag('default-product.png'), product %>  <%# Add a default image %>
        <% end %>
        <% if product.condition? %>
          <div class="condition">
            <span class="tag is-dark"><%= product.condition %></span>
          </div>
        <% end %>
      </div>
      <div class="pa3">
        <h3 class="fw7 f4 title"><%= link_to product.title, product %></h3>
        <p class="has-text-gray fg pt1">Sold by: <%= seller_name(product) %></p>
        <p class="f3 fw6 has-text-right pt2 price"><%= number_to_currency(product.price) %></p>

        <div class="buttons is-centered">
          <%# Only show Add to Cart button if user is not the product owner %>
          <% unless product_author(product) %>
            <%= button_to 'Add to Cart', 
                line_items_path(product_id: product), 
                class: "button is-primary" %>
          <% end %>
          
          <%# Only show edit/delete buttons to the product owner %>
          <% if product_author(product) %>
            <%= link_to 'Edit', edit_product_path(product), class: "button is-small is-info" %>
            <%= link_to 'Delete', 
                product, 
                method: :delete,
                data: { 
                  confirm: "Are you sure you want to delete this product?" 
                }, 
                class: "button is-small is-danger" 
            %>
          <% end %>
        </div>
      </div>
    </div>
  <% end %>
</div>